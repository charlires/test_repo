name: Main

on:
    workflow_dispatch:
        # inputs:
            # pr-number: 
            #     description: 'Pull request number to comment on.'
            #     required: true
    pull_request:
        types: [opened, edited, reopened]

jobs:
    comment-on-pr:
        runs-on: ubuntu-latest
        steps:
          - name: working with files in python
            shell: python
            run : |
              import os

              # Create and write to a file
              with open('example.txt', 'w') as f:
                  f.write('Hello, World!')

              # Read from the file
              with open('example.txt', 'r') as f:
                  content = f.read()
                  print("File content:", content)
                  
          - shell: python
            run : |
              import os
              import subprocess
              print("Hello, this is a placeholder for commenting on a PR.")

              # run command to test 
              result = subprocess.run(['echo', '-n', 'Testing command execution'], capture_output=True, text=True)
              print("Command output:", result.stdout)
              print("Command error (if any):", result.stderr.strip())
              print("Command return code:", result.returncode)

              # Example of a failing command
              fail_result = subprocess.run(['ls', '/nonexistentpath'], capture_output=True, text=True)
              print("Failing command output:", fail_result.stdout)
              print("Failing command error (if any):", fail_result.stderr.strip())
              print("Failing command return code:", fail_result.returncode)

              # Example parsing json output
              json_result = subprocess.run(['echo', '{"key": "value"}'], capture_output=True, text=True)
              import json
              data = json.loads(json_result.stdout)
              print("Parsed JSON data:", data)
              print("Value for 'key':", data['key'])

              # Example parsing yaml output
              yaml_result = subprocess.run(['echo', 'key: value'], capture_output=True, text=True)
              import yaml
              yaml_data = yaml.safe_load(yaml_result.stdout)
              print("Parsed YAML data:", yaml_data)
              print("Value for 'key':", yaml_data['key'])

              # Retry logic example (3 attempts or 1 minute timeout)
              import time
              max_retries = 3
              timeout = 60  # 1 minute in seconds
              start_time = time.time()
              
              for attempt in range(max_retries):
                elapsed_time = time.time() - start_time
                if elapsed_time >= timeout:
                  print("Timeout reached after", elapsed_time, "seconds")
                  break
                
                try:
                  # Simulate a command that may fail
                  if attempt < 2:
                    raise Exception("Simulated failure")
                  print("Command succeeded on attempt", attempt + 1)
                  break
                except Exception as e:
                  print("Attempt", attempt + 1, "failed:", str(e))
                  if attempt < max_retries - 1:
                    time.sleep(2)
                  else:
                    print("All attempts failed.")

        